<form [formGroup]="contractForm" (ngSubmit)="onSubmit()" class="max-w-[800px] mx-auto my-4 px-0 md:px-4 py-0">
  <ion-card>
    <ion-card-header>
      <ion-card-title>Contract Details</ion-card-title>
    </ion-card-header>

    <ion-card-content>
      <nz-form-item>
        <nz-form-label [nzSpan]="6" [nzLabelAlign]="'left'">Contract Name</nz-form-label>
        <nz-form-control [nzSpan]="18" nzErrorTip="Please input a valid name!">
          <input nz-input formControlName="contractName" placeholder="Enter contract name" />
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label [nzSpan]="6" [nzLabelAlign]="'left'">Share Quantity</nz-form-label>
        <nz-form-control [nzSpan]="18" nzErrorTip="Please input a valid quantity!">
          <nz-input-number
            formControlName="shareQuantity"
            [nzMin]="0"
            [nzMax]="project.remainingShares"
            [nzStep]="1"
            (nzBlur)="updateSharePercentage()"
            class="w-full">
          </nz-input-number>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label [nzSpan]="6" [nzLabelAlign]="'left'">Percentage</nz-form-label>
        <nz-form-control [nzSpan]="18" nzErrorTip="Please input a valid percentage!">
          <nz-input-number
            formControlName="percentage"
            [nzMin]="0"
            [nzMax]="project.remainingPercentOfShares"
            [nzStep]="0.01"
            (nzBlur)="updateShareQuantity()"
            class="w-full">
          </nz-input-number>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label [nzSpan]="6" [nzLabelAlign]="'left'">Contract Policy</nz-form-label>
        <nz-form-control [nzSpan]="18" nzErrorTip="Please input a valid policy!">
          <textarea nz-input formControlName="contractPolicy" rows="4" placeholder="Enter contract policy"></textarea>
        </nz-form-control>
      </nz-form-item>

      <div class="mt-6">
        <div class="flex items-center justify-between mb-4">
          <h3 class="m-0">Disbursements</h3>
          <button nz-button nzType="primary" (click)="openDisbursementModal()">
            <i nz-icon nzType="plus"></i>
          </button>
        </div>

        <nz-list [nzDataSource]="disbursements" [nzRenderItem]="disbursementItem">
          <ng-template #disbursementItem let-item let-index="index">
            <nz-list-item>
              <div class="flex w-full items-center justify-between">
                <span>{{ item.title }}</span>
                <div class="flex gap-2">
                  <button nz-button nzType="link" (click)="openDisbursementModal(item, index)">
                    <i nz-icon nzType="edit"></i>
                  </button>
                  <button nz-button nzType="link" nzDanger (click)="removeDisbursement(index)">
                    <i nz-icon nzType="delete"></i>
                  </button>
                </div>
              </div>
            </nz-list-item>
          </ng-template>
        </nz-list>
      </div>

      <div class="mt-6 text-right">
        <button nz-button nzType="primary" type="submit" [disabled]="!contractForm.valid">
          Submit
        </button>
      </div>
    </ion-card-content>
  </ion-card>
</form>
